<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Memória</title>
    <style>
        /* Estilo geral da página */
        body { font-family: Arial, sans-serif; text-align: center; }

        /* Tabuleiro do jogo */
        .game-board { 
            display: grid; 
            grid-template-columns: repeat(4, 100px); 
            gap: 10px; 
            justify-content: center; 
        }

        /* Estilo das cartas */
        .card { 
            width: 100px; 
            height: 100px; 
            background: #eee; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            position: relative; 
            border-radius: 8px; 
            box-shadow: 0 0 5px rgba(0,0,0,0.1); 
            overflow: hidden; 
        }

        /* Imagem da carta */
        .card img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            border-radius: 8px; 
        }

        /* Carta escondida (quando o par é feito) */
        .hidden { 
            visibility: hidden; 
        }
    </style>
</head>
<body>
    <h1>Jogo da Memória</h1>
    <p>Tempo restante: <span id="timer">60</span> segundos</p>
    <div class="game-board" id="gameBoard"></div>
    <p><a href="/logout">Sair</a> | <a href="/historico.html">Ver Histórico</a></p>

    <script>
        // Lista de imagens fixas com seus respectivos IDs
        const images = [
            { id: 'img1', src: 'cao1.jpeg' },
            { id: 'img2', src: 'cao2.jpeg' },
            { id: 'img3', src: 'cao3.jpeg' },
            { id: 'img4', src: 'cao4.jpeg' },
            { id: 'img5', src: 'cao5.jpeg' },
            
        ];

        // Variáveis de controle do jogo
        let cards = [];
        let selectedCards = [];
        let matchedCards = [];
        let timeLeft = 60;
        let timerInterval;

        // Função para embaralhar um array
        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        // Cria o tabuleiro do jogo
        function createBoard() {
            const board = document.getElementById("gameBoard");
            board.innerHTML = "";

            // Duplica as imagens e embaralha
            cards = shuffle([...images, ...images]);

            // Cria cada carta do jogo
            cards.forEach((imgObj, index) => {
                const card = document.createElement("div");
                card.classList.add("card");
                card.dataset.id = imgObj.id;
                card.dataset.index = index;

                const frontImage = document.createElement("img");
                frontImage.src = imgObj.src;
                frontImage.classList.add("front");

                card.appendChild(frontImage);
                card.addEventListener("click", () => flipCard(card));
                board.appendChild(card);
            });

            // Inicia o temporizador
            startTimer();
        }

        // Função chamada ao clicar em uma carta
        function flipCard(card) {
            // Ignora se a carta é inválida, já selecionada ou já foi encontrada
            if (!card || selectedCards.includes(card) || card.classList.contains("hidden")) return;

            // Adiciona carta ao array de seleção
            if (selectedCards.length < 2) {
                selectedCards.push(card);
            }

            // Verifica combinação após 2 cartas clicadas
            if (selectedCards.length === 2) {
                setTimeout(checkMatch, 500);
            }
        }

        // Verifica se as duas cartas selecionadas são um par
        function checkMatch() {
            const [card1, card2] = selectedCards;
            if (card1 && card2 && card1.dataset.id === card2.dataset.id) {
                card1.classList.add("hidden");
                card2.classList.add("hidden");
                matchedCards.push(card1.dataset.id);

                // Verifica se o jogador encontrou todos os pares
                if (matchedCards.length === images.length) {
                    clearInterval(timerInterval);
                    alert("Parabéns! Você encontrou todos os pares.");
                    salvarHistorico();
                }
            }
            // Limpa seleção de cartas
            selectedCards = [];
        }

        // Inicia o temporizador do jogo
        function startTimer() {
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    document.getElementById("timer").textContent = timeLeft;
                } else {
                    clearInterval(timerInterval);
                    alert("Tempo esgotado! Tente novamente.");
                    salvarHistorico(false);
                    location.reload();
                }
            }, 1000);
        }

        // Envia o histórico do resultado para o servidor
        function salvarHistorico(vitoria = true) {
            fetch('/historico', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    tempoRestante: timeLeft,
                    resultado: vitoria ? 'Vitória' : 'Derrota'
                })
            })
            .then(res => res.text())
            .then(msg => console.log(msg));
        }

        // Inicia o jogo quando a página estiver carregada
        document.addEventListener("DOMContentLoaded", createBoard);
    </script>
</body>
</html>
